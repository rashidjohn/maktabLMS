{% extends 'base.html' %}
{% block title %}Mening Testlarim va Natijalarim{% endblock %}

{% block content %}
<style>
    /* --- SENIOR STUDENT DASHBOARD DESIGN SYSTEM --- */
    :root {
        --primary-deep: #1e3a8a;
        --primary-light: #3b82f6;
        --accent-emerald: #10b981;
        --accent-emerald-dark: #059669;
        --accent-rose: #ef4444;
        --accent-rose-dark: #be123c;
        --bg-main: #f8fafc;
        --surface-white: #ffffff;
        --text-dark: #0f172a;
        --text-muted: #64748b;
        --border-soft: #e2e8f0;
        --radius-xl: 20px;
        --radius-lg: 16px;
        --radius-md: 10px;
        --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
        background-color: var(--bg-main) !important;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }

    /* Headings */
    h2.text-primary {
        color: var(--primary-deep) !important;
        letter-spacing: -0.025em;
        font-size: 1.8rem;
    }

    h2.text-success {
        color: var(--accent-emerald-dark) !important;
        letter-spacing: -0.025em;
        font-size: 1.8rem;
    }

    /* Badge Customization */
    .badge.bg-info {
        background: #e0f2fe !important;
        color: #0369a1 !important;
        border: 1px solid #bae6fd;
        padding: 0.6em 1.2em !important;
        border-radius: 8px !important;
        font-weight: 600;
    }

    /* Card Enhancements */
    .card {
        border-radius: var(--radius-lg) !important;
        background: var(--surface-white) !important;
        box-shadow: var(--shadow-soft) !important;
        transition: var(--transition) !important;
        overflow: hidden;
        animation: fadeUp 0.5s ease-out forwards;
        opacity: 0;
    }

    .card.hover-zoom:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover) !important;
    }

    /* Override Bootstrap Left Borders for Premium Look */
    .border-start.border-primary.border-4 {
        border-left: 5px solid var(--primary-deep) !important;
    }

    .border-start.border-success.border-4 {
        border-left: 5px solid var(--accent-emerald) !important;
    }

    /* Quiz Info List Styling */
    .list-unstyled li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.6rem 0;
        border-bottom: 1px dashed var(--border-soft);
        color: #475569;
        font-size: 0.95rem;
    }

    .list-unstyled li:last-child {
        border-bottom: none;
    }

    .list-unstyled li strong {
        color: var(--text-dark);
        font-weight: 600;
    }

    /* Button Styling */
    .btn-primary {
        background: linear-gradient(135deg, var(--primary-deep) 0%, var(--primary-light) 100%) !important;
        border: none !important;
        border-radius: var(--radius-md) !important;
        padding: 12px 24px !important;
        font-size: 1rem !important;
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.25) !important;
        transition: var(--transition) !important;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(30, 58, 138, 0.35) !important;
        filter: brightness(1.05);
    }

    /* Results Card Specifics */
    .card.bg-light {
        background: #ffffff !important; /* Force clean white */
        background-image: linear-gradient(to bottom right, #ffffff, #f8fafc) !important;
    }

    .card-body h2 {
        font-size: 3rem;
        letter-spacing: -0.05em;
        margin: 0.5rem 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .text-success { color: var(--accent-emerald) !important; }
    .text-danger { color: var(--accent-rose) !important; }

    .badge.bg-success {
        background: linear-gradient(135deg, var(--accent-emerald) 0%, #059669 100%) !important;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .badge.bg-danger {
        background: linear-gradient(135deg, var(--accent-rose) 0%, #dc2626 100%) !important;
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    /* Empty States */
    .alert-light {
        background-color: var(--surface-white) !important;
        border-radius: var(--radius-lg) !important;
        font-size: 1.05rem;
        border: 1px dashed #cbd5e1 !important;
    }

    /* Animations */
    @keyframes fadeUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4 mt-3">
    <h2 class="text-primary fw-bold">üìö Mavjud Testlar</h2>
    <div>
        <span class="badge bg-info text-dark fs-6 me-2">{{ classroom.name }} sinfi</span>
    </div>
</div>

<div class="row mb-5" id="available-quizzes-grid">
    {% for quiz in available_quizzes %}
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100 border-0 border-start border-primary border-4 hover-zoom">
            <div class="card-body d-flex flex-column">
                <h4 class="card-title text-dark fw-bold mb-1">{{ quiz.subject.name }}</h4>
                <h6 class="card-subtitle mb-4 text-muted">{{ quiz.title }}</h6>
                <ul class="list-unstyled mb-4 flex-grow-1">
                    <li><span>‚è±Ô∏è <strong>Vaqt:</strong></span> <span>{{ quiz.duration_minutes }} daqiqa</span></li>
                    <li><span>üéØ <strong>O'tish bali:</strong></span> <span><span class="badge bg-light text-dark border">{{ quiz.pass_score }}%</span></span></li>
                    <li><span>‚ùì <strong>Savollar:</strong></span> <span>{{ quiz.questions.count }} ta</span></li>
                </ul>
                <a href="{% url 'take_quiz' quiz.id %}" class="btn btn-primary w-100 fw-bold mt-auto">Testni boshlash üöÄ</a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-light border text-center py-5 text-muted shadow-sm">
            <i class="bi bi-inbox fs-1 d-block mb-3 opacity-50"></i>
            Hozircha ishlash uchun yangi testlar yo'q.
        </div>
    </div>
    {% endfor %}
</div>

<div class="d-flex justify-content-between align-items-center mb-4 border-top pt-4">
    <h2 class="text-success fw-bold">‚úÖ Mening Natijalarim</h2>
</div>

<div class="row" id="results-grid">
    {% for result in student_results %}
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100 border-0 border-start border-success border-4 bg-light hover-zoom">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <h5 class="text-dark fw-bold mb-1">{{ result.quiz.subject.name }}</h5>
                <h6 class="mb-4 text-muted">{{ result.quiz.title }}</h6>

                <div class="my-2">
                    {% if result.score >= result.quiz.pass_score %}
                        <h2 class="text-success fw-bold">{{ result.score }}%</h2>
                        <span class="badge bg-success px-4 py-2 fs-6 rounded-pill">O'tdi</span>
                    {% else %}
                        <h2 class="text-danger fw-bold">{{ result.score }}%</h2>
                        <span class="badge bg-danger px-4 py-2 fs-6 rounded-pill">Yiqildi</span>
                    {% endif %}
                </div>

                <div class="mt-4 pt-3 border-top text-muted small text-start">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-semibold">To'g'ri javoblar:</span>
                        <span class="fw-bold text-dark bg-white px-2 py-1 rounded border">{{ result.correct_answers }} / {{ result.total_questions }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-semibold">Sana:</span>
                        <span><i class="text-secondary">{{ result.completed_at|date:"d.m.Y H:i" }}</i></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-light border text-center py-5 text-muted shadow-sm">
            <i class="bi bi-journal-x fs-1 d-block mb-3 opacity-50"></i>
            Siz hali hech qanday test ishlamagansiz.
        </div>
    </div>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Staggered loading animation for Quizzes
        const quizCards = document.querySelectorAll('#available-quizzes-grid .card');
        quizCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });

        // Staggered loading animation for Results
        const resultCards = document.querySelectorAll('#results-grid .card');
        resultCards.forEach((card, index) => {
            card.style.animationDelay = `${(quizCards.length * 0.1) + (index * 0.1)}s`;
        });
        
        // Micro-interaction: Change left border color dynamically for failed results to red
        const dangerScores = document.querySelectorAll('.text-danger.fw-bold');
        dangerScores.forEach(score => {
            const parentCard = score.closest('.card');
            if(parentCard) {
                parentCard.classList.remove('border-success');
                parentCard.classList.add('border-danger');
                parentCard.style.setProperty('border-left', '5px solid var(--accent-rose)', 'important');
            }
        });
    });
</script>
{% endblock %}